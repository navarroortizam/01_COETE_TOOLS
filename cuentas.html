<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Coete - Gesti칩n de Cuentas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>

<body class="bg-slate-100 text-slate-800 transition-colors duration-300">
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDIfYedJ-S-fvVeRHRq3o-BEv0es_EUH9U",
            authDomain: "coete-system.firebaseapp.com",
            projectId: "coete-system",
            storageBucket: "coete-system.firebasestorage.app",
            messagingSenderId: "139946462232",
            appId: "1:139946462232:web:fcc25397ebaac8c10cc76d"
        };

        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            console.log("游댠 Cuentas conectado a Firebase");
        } catch (e) {
            console.error("Error conectando Firebase:", e);
        }

        import React, { useState, useEffect } from "https://esm.sh/react@18";
        import ReactDOM from "https://esm.sh/react-dom@18";

        const IconPlus = () => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement("line", { x1: "12", y1: "5", x2: "12", y2: "19" }), React.createElement("line", { x1: "5", y1: "12", x2: "19", y2: "12" }));
        const IconCheck = () => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", width: "16", height: "16", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement("polyline", { points: "20 6 9 17 4 12" }));
        const IconSun = () => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement("circle", { cx: "12", cy: "12", r: "5" }), React.createElement("path", { d: "M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" }));
        const IconMoon = () => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", width: "20", height: "20", viewBox: "0 0 24 24", fill: "none", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round" }, React.createElement("path", { d: "M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" }));

        const CuentasApp = () => {
            const [darkMode, setDarkMode] = useState(false);
            const [local, setLocal] = useState('coete1');
            const [cuentas, setCuentas] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showForm, setShowForm] = useState(false);
            const [filtro, setFiltro] = useState('pendientes');
            const [formData, setFormData] = useState({
                proveedor: '',
                descripcion: '',
                monto: '',
                fechaVencimiento: '',
                estado: 'pendiente'
            });

            const proveedores = ["Distribuidora Caf칠", "Proveedor L치cteos", "Panader칤a", "Verduler칤a", "Carnicer칤a", "Bebidas", "Aseo", "Servicios", "Mantenci칩n", "Otro"];

            useEffect(() => {
                fetchCuentas();
            }, []);

            const fetchCuentas = async () => {
                if (!db) return;
                try {
                    const q = query(collection(db, "cuentas"), orderBy("fechaCreacion", "desc"));
                    const querySnapshot = await getDocs(q);
                    const data = [];
                    querySnapshot.forEach((doc) => {
                        data.push({ id: doc.id, ...doc.data() });
                    });
                    setCuentas(data);
                    setLoading(false);
                } catch (e) {
                    console.error("Error cargando cuentas:", e);
                    setLoading(false);
                }
            };

            const handleSubmit = async () => {
                if (!formData.proveedor || !formData.monto) {
                    alert("Proveedor y monto son obligatorios");
                    return;
                }
                try {
                    await addDoc(collection(db, "cuentas"), {
                        ...formData,
                        local: local,
                        monto: Number(formData.monto),
                        fechaCreacion: serverTimestamp(),
                        estado: 'pendiente'
                    });
                    setFormData({ proveedor: '', descripcion: '', monto: '', fechaVencimiento: '', estado: 'pendiente' });
                    setShowForm(false);
                    fetchCuentas();
                } catch (e) {
                    console.error("Error guardando cuenta:", e);
                    alert("Error al guardar");
                }
            };

            const marcarPagada = async (id) => {
                try {
                    await updateDoc(doc(db, "cuentas", id), {
                        estado: 'pagada',
                        fechaPago: new Date().toISOString()
                    });
                    fetchCuentas();
                } catch (e) {
                    console.error("Error actualizando:", e);
                }
            };

            const cuentasFiltradas = cuentas.filter(c => {
                if (c.local && c.local !== local) return false;
                if (filtro === 'pendientes') return c.estado === 'pendiente';
                if (filtro === 'pagadas') return c.estado === 'pagada';
                return true;
            });

            const cuentasLocal = cuentas.filter(c => !c.local || c.local === local);
            const totalPendiente = cuentasLocal.filter(c => c.estado === 'pendiente').reduce((sum, c) => sum + (Number(c.monto) || 0), 0);
            const totalPagado = cuentasLocal.filter(c => c.estado === 'pagada').reduce((sum, c) => sum + (Number(c.monto) || 0), 0);

            return React.createElement("div", { className: `max-w-md mx-auto min-h-screen shadow-xl overflow-hidden flex flex-col transition-colors duration-300 ${darkMode ? 'bg-slate-900 text-slate-100' : 'bg-slate-100 text-slate-800'}` },
                
                // Header
                React.createElement("header", { className: `p-6 pb-8 sticky top-0 z-10 flex justify-between items-center ${darkMode ? 'bg-slate-800 text-white' : 'bg-slate-900 text-white'}` },
                    React.createElement("div", null,
                        React.createElement("h1", { className: "text-xl font-bold" }, "游눯 Cuentas por Pagar"),
                        React.createElement("div", { className: "flex gap-2 mt-2" },
                            React.createElement("button", { onClick: () => setLocal('coete1'), className: `px-3 py-1 rounded-full text-xs font-bold transition-all ${local === 'coete1' ? 'bg-[#ff6b00] text-white' : 'bg-white/20 text-white/70'}` }, "Coete 1"),
                            React.createElement("button", { onClick: () => setLocal('coete2'), className: `px-3 py-1 rounded-full text-xs font-bold transition-all ${local === 'coete2' ? 'bg-[#ff6b00] text-white' : 'bg-white/20 text-white/70'}` }, "Coete 2")
                        )
                    ),
                    React.createElement("button", { onClick: () => setDarkMode(!darkMode), className: "p-2 rounded-full bg-white/10 hover:bg-white/20 transition" },
                        darkMode ? React.createElement(IconSun) : React.createElement(IconMoon)
                    )
                ),

                // Contenido
                React.createElement("div", { className: `flex-1 p-6 -mt-4 rounded-t-3xl overflow-y-auto transition-colors duration-300 ${darkMode ? 'bg-slate-900' : 'bg-white'}` },
                    
                    // KPIs
                    React.createElement("div", { className: "grid grid-cols-2 gap-3 mb-6" },
                        React.createElement("div", { className: `p-4 rounded-xl border ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-red-50 border-red-100'}` },
                            React.createElement("p", { className: "text-xs font-bold text-red-500 mb-1" }, "游댮 PENDIENTE"),
                            React.createElement("p", { className: "text-xl font-bold font-mono text-red-600" }, `$${totalPendiente.toLocaleString()}`)
                        ),
                        React.createElement("div", { className: `p-4 rounded-xl border ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-green-50 border-green-100'}` },
                            React.createElement("p", { className: "text-xs font-bold text-green-500 mb-1" }, "游릭 PAGADO"),
                            React.createElement("p", { className: "text-xl font-bold font-mono text-green-600" }, `$${totalPagado.toLocaleString()}`)
                        )
                    ),

                    // Filtros
                    React.createElement("div", { className: "flex gap-2 mb-4" },
                        ['pendientes', 'pagadas', 'todas'].map(f => 
                            React.createElement("button", { 
                                key: f, 
                                onClick: () => setFiltro(f),
                                className: `px-4 py-2 rounded-full text-xs font-bold transition-all ${filtro === f ? 'bg-[#ff6b00] text-white' : darkMode ? 'bg-slate-800 text-slate-400' : 'bg-slate-100 text-slate-500'}`
                            }, f.charAt(0).toUpperCase() + f.slice(1))
                        )
                    ),

                    // Lista de Cuentas
                    loading ? 
                        React.createElement("p", { className: "text-center py-10 text-slate-400" }, "Cargando...") :
                        React.createElement("div", { className: "space-y-3" },
                            cuentasFiltradas.length === 0 ? 
                                React.createElement("p", { className: "text-center py-10 text-slate-400 text-sm" }, "No hay cuentas en esta categor칤a") :
                                cuentasFiltradas.map(cuenta => 
                                    React.createElement("div", { 
                                        key: cuenta.id, 
                                        className: `p-4 rounded-xl border transition-all fade-in ${cuenta.estado === 'pagada' ? 'opacity-60' : ''} ${darkMode ? 'bg-slate-800 border-slate-700' : 'bg-slate-50 border-slate-200'}`
                                    },
                                        React.createElement("div", { className: "flex justify-between items-start" },
                                            React.createElement("div", null,
                                                React.createElement("p", { className: "font-bold" }, cuenta.proveedor),
                                                cuenta.descripcion && React.createElement("p", { className: "text-xs text-slate-400 mt-1" }, cuenta.descripcion),
                                                cuenta.fechaVencimiento && React.createElement("p", { className: "text-[10px] text-orange-500 mt-1" }, `Vence: ${cuenta.fechaVencimiento}`)
                                            ),
                                            React.createElement("div", { className: "text-right" },
                                                React.createElement("p", { className: `font-bold font-mono ${cuenta.estado === 'pendiente' ? 'text-red-500' : 'text-green-500'}` }, `$${Number(cuenta.monto).toLocaleString()}`),
                                                cuenta.estado === 'pendiente' && 
                                                    React.createElement("button", { 
                                                        onClick: () => marcarPagada(cuenta.id),
                                                        className: "mt-2 px-3 py-1 bg-green-500 text-white text-xs font-bold rounded-full flex items-center gap-1 hover:bg-green-600 transition"
                                                    }, React.createElement(IconCheck), "Pagada")
                                            )
                                        )
                                    )
                                )
                        ),

                    // Formulario Nueva Cuenta
                    showForm && React.createElement("div", { className: `fixed inset-0 bg-black/50 z-50 flex items-end` },
                        React.createElement("div", { className: `w-full max-w-md mx-auto p-6 rounded-t-3xl ${darkMode ? 'bg-slate-800' : 'bg-white'}` },
                            React.createElement("h2", { className: "font-bold text-lg mb-4" }, "Nueva Cuenta"),
                            React.createElement("div", { className: "space-y-4" },
                                React.createElement("select", { 
                                    value: formData.proveedor, 
                                    onChange: (e) => setFormData({...formData, proveedor: e.target.value}),
                                    className: `w-full p-3 border rounded-xl ${darkMode ? 'bg-slate-700 border-slate-600 text-white' : 'bg-slate-50 border-slate-200'}`
                                },
                                    React.createElement("option", { value: "" }, "Seleccionar Proveedor"),
                                    proveedores.map(p => React.createElement("option", { key: p, value: p }, p))
                                ),
                                React.createElement("input", { 
                                    type: "number", 
                                    placeholder: "Monto $", 
                                    value: formData.monto,
                                    onChange: (e) => setFormData({...formData, monto: e.target.value}),
                                    className: `w-full p-3 border rounded-xl font-mono ${darkMode ? 'bg-slate-700 border-slate-600 text-white' : 'bg-slate-50 border-slate-200'}`
                                }),
                                React.createElement("input", { 
                                    type: "text", 
                                    placeholder: "Descripci칩n (opcional)", 
                                    value: formData.descripcion,
                                    onChange: (e) => setFormData({...formData, descripcion: e.target.value}),
                                    className: `w-full p-3 border rounded-xl ${darkMode ? 'bg-slate-700 border-slate-600 text-white' : 'bg-slate-50 border-slate-200'}`
                                }),
                                React.createElement("input", { 
                                    type: "date", 
                                    value: formData.fechaVencimiento,
                                    onChange: (e) => setFormData({...formData, fechaVencimiento: e.target.value}),
                                    className: `w-full p-3 border rounded-xl ${darkMode ? 'bg-slate-700 border-slate-600 text-white' : 'bg-slate-50 border-slate-200'}`
                                }),
                                React.createElement("div", { className: "flex gap-3" },
                                    React.createElement("button", { onClick: () => setShowForm(false), className: `flex-1 py-3 rounded-xl font-bold border ${darkMode ? 'border-slate-600 text-slate-300' : 'border-slate-200 text-slate-500'}` }, "Cancelar"),
                                    React.createElement("button", { onClick: handleSubmit, className: "flex-1 py-3 bg-[#ff6b00] text-white rounded-xl font-bold" }, "Guardar")
                                )
                            )
                        )
                    )
                ),

                // Bot칩n flotante
                React.createElement("button", { 
                    onClick: () => setShowForm(true),
                    className: "fixed bottom-6 right-6 w-14 h-14 bg-[#ff6b00] text-white rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-transform"
                }, React.createElement(IconPlus))
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(CuentasApp));
    </script>
</body>

</html>
