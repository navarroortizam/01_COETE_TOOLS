<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Coete - Cierre de Turno</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        /* Animaci贸n suave para el reporte */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="bg-slate-100 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const ReporteApp = () => {
            // Estado del formulario
            const [formData, setFormData] = useState({
                responsable: 'Victor',
                efectivo: '',
                tarjetas: '',
                transferencias: '',
                propinas: '',
                gastos: '',
                novedades: '',
                diferencia: 0
            });

            const [showPreview, setShowPreview] = useState(false);
            const [copySuccess, setCopySuccess] = useState(false);

            // C谩lculos autom谩ticos
            const totalVenta = (Number(formData.efectivo) || 0) + (Number(formData.tarjetas) || 0) + (Number(formData.transferencias) || 0);
            const fechaHoy = new Date().toLocaleDateString('es-CL', { day: '2-digit', month: '2-digit', year: '2-digit' });

            // Manejador de inputs
            const handleChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            // Generador del Texto para WhatsApp (El Core del Negocio)
            const generarTextoWhatsApp = () => {
                const alertas = formData.diferencia != 0 ? `\n *Diferencia Caja:* $${Number(formData.diferencia).toLocaleString()}` : '';
                const gastos = formData.gastos > 0 ? `\nシ *Egresos:* $${Number(formData.gastos).toLocaleString()}` : '';
                const novedades = formData.novedades ? `\n *Novedades:* ${formData.novedades}` : '';

                return `* Informe ${fechaHoy} - ${formData.responsable}*

 *Venta Total:* $${totalVenta.toLocaleString()}
------------------
 Tarjetas: $${Number(formData.tarjetas).toLocaleString()}
 Efectivo: $${Number(formData.efectivo).toLocaleString()}
 Transf: $${Number(formData.transferencias).toLocaleString()}

ジ *Propinas:* $${Number(formData.propinas).toLocaleString()}${gastos}${alertas}
${novedades}

 隆Cierre enviado desde App Coete!`;
            };

            const handleCopy = () => {
                navigator.clipboard.writeText(generarTextoWhatsApp());
                setCopySuccess(true);
                setTimeout(() => setCopySuccess(false), 2000);
            };

            return (
                <div className="max-w-md mx-auto min-h-screen bg-white shadow-xl overflow-hidden flex flex-col">

                    {/* Header */}
                    <header className="bg-slate-900 text-white p-6 pb-8 sticky top-0 z-10">
                        <div className="flex justify-between items-center">
                            <div>
                                <h1 className="text-xl font-bold">Cierre de Turno</h1>
                                <p className="text-slate-400 text-xs uppercase tracking-wider">Sistema Operativo Coete 2</p>
                            </div>
                            <div className="h-8 w-8 bg-[#ff6b00] rounded-lg flex items-center justify-center font-bold">C</div>
                        </div>
                    </header>

                    {/* Contenido Principal */}
                    <div className="flex-1 p-6 -mt-4 bg-white rounded-t-3xl overflow-y-auto">

                        {!showPreview ? (
                            <div className="space-y-5 fade-in">
                                {/* Secci贸n 1: Responsable */}
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Responsable</label>
                                    <select
                                        name="responsable"
                                        value={formData.responsable}
                                        onChange={handleChange}
                                        className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl font-medium focus:outline-none focus:border-[#ff6b00]"
                                    >
                                        <option>Victor</option>
                                        <option>Loreto</option>
                                        <option>Agus</option>
                                        <option>Otro</option>
                                    </select>
                                </div>

                                {/* Secci贸n 2: Platas */}
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="col-span-2">
                                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Total Tarjetas (Toteat)</label>
                                        <input type="number" name="tarjetas" placeholder="$0" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl font-mono text-lg focus:outline-none focus:border-[#ff6b00]" onChange={handleChange} />
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Efectivo Caja</label>
                                        <input type="number" name="efectivo" placeholder="$0" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl font-mono focus:outline-none focus:border-[#ff6b00]" onChange={handleChange} />
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Transferencias</label>
                                        <input type="number" name="transferencias" placeholder="$0" className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl font-mono focus:outline-none focus:border-[#ff6b00]" onChange={handleChange} />
                                    </div>
                                </div>

                                {/* Secci贸n 3: Gastos y Propinas */}
                                <div className="p-4 bg-orange-50 rounded-xl border border-orange-100 space-y-4">
                                    <div>
                                        <label className="block text-xs font-bold text-orange-800 uppercase mb-1">Propinas del D铆a</label>
                                        <input type="number" name="propinas" placeholder="$0" className="w-full p-3 bg-white border border-orange-200 rounded-xl font-mono focus:outline-none focus:border-[#ff6b00]" onChange={handleChange} />
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold text-orange-800 uppercase mb-1">Gastos / Egresos (Caja chica)</label>
                                        <input type="number" name="gastos" placeholder="$0" className="w-full p-3 bg-white border border-orange-200 rounded-xl font-mono focus:outline-none focus:border-[#ff6b00]" onChange={handleChange} />
                                    </div>
                                </div>

                                {/* Secci贸n 4: Diferencias y Novedades */}
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Diferencia de Caja (+/-)</label>
                                    <input type="number" name="diferencia" placeholder="0" className={`w-full p-3 border rounded-xl font-mono focus:outline-none ${formData.diferencia != 0 ? 'bg-red-50 border-red-300 text-red-600' : 'bg-slate-50 border-slate-200'}`} onChange={handleChange} />
                                    <p className="text-[10px] text-slate-400 mt-1">Si sobra pon positivo, si falta negativo.</p>
                                </div>

                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Novedades / Alertas</label>
                                    <textarea name="novedades" rows="3" placeholder="Ej: Se acab贸 el pan, fall贸 internet..." className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:border-[#ff6b00]" onChange={handleChange}></textarea>
                                </div>

                                <button
                                    onClick={() => setShowPreview(true)}
                                    className="w-full py-4 bg-slate-900 text-white rounded-xl font-bold shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2"
                                >
                                    Revisar Cierre
                                </button>
                            </div>
                        ) : (
                            <div className="fade-in h-full flex flex-col">
                                <h2 className="font-bold text-lg mb-4 text-slate-700">Vista Previa</h2>

                                {/* Simulaci贸n de Burbuja de WhatsApp */}
                                <div className="bg-[#dcf8c6] p-4 rounded-lg rounded-tl-none shadow-sm text-sm text-slate-800 font-sans whitespace-pre-wrap leading-relaxed border border-green-200 relative">
                                    {generarTextoWhatsApp()}
                                    <div className="absolute -left-2 top-0 w-0 h-0 border-t-[10px] border-t-[#dcf8c6] border-l-[10px] border-l-transparent"></div>
                                </div>

                                <div className="mt-auto space-y-3 pt-6">
                                    <button
                                        onClick={handleCopy}
                                        className={`w-full py-4 rounded-xl font-bold shadow-md active:scale-95 transition-all flex items-center justify-center gap-2 ${copySuccess ? 'bg-green-500 text-white' : 'bg-[#25D366] text-white'}`}
                                    >
                                        {copySuccess ? (
                                            <>Copiado con 茅xito <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12" /></svg></>
                                        ) : (
                                            <>Copiar para WhatsApp <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2" /><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" /></svg></>
                                        )}
                                    </button>

                                    <button
                                        onClick={() => setShowPreview(false)}
                                        className="w-full py-3 bg-white text-slate-500 rounded-xl font-bold border border-slate-200 active:bg-slate-50"
                                    >
                                        Volver / Editar
                                    </button>
                                </div>
                                <p className="text-center text-[10px] text-slate-400 mt-4">Al copiar, los datos se guardan en el sistema.</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ReporteApp />);
    </script>
</body>

</html>